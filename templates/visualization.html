<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <title>Visualization</title>

    <!-- import css -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}" media="screen" />

    <!--匯入 JavaScript-->
    <script src="http://d3js.org/d3.v4.min.js"></script>
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://apps.bdimg.com/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="{% static 'bootstrap/js/bootstrap.min.js' %}"></script>
</head>

<body>
    <h5 id="hello"></h5>
    <!--選單列-->
    <div id="menu" class="row">
        <div id="station_select_div" class="col-md-4">
            地名
            <select class="form-control" id="station_select">
                {% for station in station_list %}
                    <option value={{station}}>{{station}}</option>
                {% endfor %}
            </select>
        </div>

        <div id="attribute_select_div" class="col-md-4">
            觀察對象
            <select class="form-control" id="attribute_select">
                {% for attribute in attribute_list %}
                    <option value={{attribute}}>{{attribute}}</option>
                {% endfor %}
            </select>
        </div>
    </div>

    <!--視覺化元件-->
    <div id="map_holder" class="row">
        <!--台灣地圖-->
        <div id="taiwan_map" class="col-md">taiwan_map</div>
    </div>

    <div id="chart_holder" class="row">
        <!--時間序列圖表-->
        <div id="time_chart_div" class="col-md-12">
            time_chart
        </div>

        <!--直方圖-->
        <!--
        <div id="bar_chart_div" class="col-md-6">
            <h5>bar_chart</h5>
        </div>
        -->

    </div>
    <div >
        <button type="button" id="btn">hello</button>
    </div>
</body>

<!--視覺化JS檔-->
<!--
    <script src="js/core.js"></script>
    <script src="js/menu.js"></script>
    <script src="js/time_chart.js"></script>
    <script src="js/bar_chart.js"></script>
    <script src="js/main.js"></script>
-->

{% block javascript %}
<script>
    var station = 'Banqiao';
    var attribute = 'AMB_TEMP';
    var selectValue, selectTime;

    $.ajax({
        url:"/weather/station_change",
        data:{"select_station_value":station, "select_attribute_value":attribute},
        dataType:"json",
        success: function(back){
                selectValue = back.user_request_data;
                selectTime = back.user_request_time;
                plotLine();
        }
    });

    // 選單列控制
    d3.select("#menu #station_select").on('change', function(){
      station = d3.select("#menu #station_select").property('value');
    });

    d3.select("#menu #attribute_select").on('change', function(){
      attribute = d3.select("#menu #attribute_select").property('value');
    });

    //資料庫
    $("#btn").click(function(){
        alert(station)
        $.ajax({
            url:"/weather/station_change",
            data:{"select_station_value":station, "select_attribute_value":attribute},
            dataType:"json",
            success: function(back){
                    selectValue = back.user_request_data;
                    selectTime = back.user_request_time;
            }
        });
    });

    function plotLine(){
      //曲線圖
      var timeChartSelectSvg = d3.select('#chart_holder #time_chart_div')
                                 .append('svg').attr('id','time_chart_svg');

      var timeChartBounding = d3.select('#chart_holder #time_chart_div')
                                .node().getBoundingClientRect();

      var margin = {top: 40, right: 10, bottom: 20, left: 10},
          height = timeChartBounding.height - margin.top - margin.bottom,
          width = timeChartBounding.width - margin.right - margin.left;

      alert(selectTime)
      var xScale = d3.scaleTime().domain(selectTime).range([margin.left, width]);
      var xAxis = d3.axisBottom(xScale);
      timeChartSelectSvg.append('g').attr('id', 'time_chart_axis').call(xAxis).attr("transform", "translate(0," + height + ")");
    }

</script>
{% endblock %}

</html>
